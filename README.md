# PokeYellowAI

PokeYellowAI aims to train reinforcement learning agents to play **Pokémon Yellow** using [Gym Retro](https://github.com/openai/retro).  The repository contains scripts for extracting static game data, a goal-based reward implementation, and a simple training loop using PPO.

## Prerequisites

- Python 3.8 or newer
- A legally obtained copy of *Pokémon Yellow* placed outside this repository
  (this repository does **not** include the game ROM)
- Python dependencies listed in `requirements.txt` (Gym Retro, NumPy, PyYAML, PyTorch)

Install the Python packages with:

```bash
pip install -r requirements.txt
```

## Extracting Static Data

Some parts of the reward system rely on lookup tables for map IDs, item IDs and event flag offsets.  These can be generated by running:

```bash
python scripts/extract_static_data.py
```

The script expects `maps.asm`, `items.asm` and `ram_map.txt` from the
[Pokémon Yellow disassembly](https://github.com/pret/pokeyellow) project to
be placed in the repository root. These names reflect the directory layout of
recent versions of the disassembly—if you use an older revision you may need
to adjust the paths accordingly. `ram_map.txt` should contain lines like:

```
$D747 Event Flag 0: Started the game
$D748 Event Flag 1: Received Pokédex
```

Each line begins with the flag's address followed by its description.  Running the script will create the following files under `data/`:

- `data/map_ids.json`
- `data/item_ids.json`
- `data/event_flags.json`

## Goal Definitions

Goal curricula are stored as JSON files inside the `data/` directory.  The repository provides `data/first_three_gyms.json` as an example, containing goals for reaching the first towns and defeating the first three gym leaders.

## Goal-Based Rewards

Rewards are produced by comparing consecutive WRAM snapshots.  Goals can trigger on map transitions or specific event flag bits (including badge flags).  Each goal entry contains:

- `id`: unique string identifier
- `type`: either `"map"` or `"event"`
- `target_id`: numeric map ID or flag index
- optional `reward` value and `prerequisites`

`poke_rewards.check_goals` takes two memory snapshots and returns the goals that were achieved in that frame.

Additional goal predicates are now available for item pickups and scripted events,
enabling more fine-grained progress tracking. A cumulative rewarder component
aggregates rewards over an episode so long-term goals still provide shaping
signals even when completed late in the run.

## Training

Training uses a small PPO implementation found in `train_agent.py`. The
examples below create the environment directly with Gym Retro. If you have
your own wrapper for handling ROM resets or memory snapshots, you can adapt the
code accordingly.

Place your ROM in a directory outside this repository and register it with Gym
Retro:

```bash
python -m retro.import /path/to/PokemonYellow.gbc --output integrations
```

This creates `integrations/PokemonYellow-GB` containing the ROM and metadata.
To instantiate the environment programmatically:

```python
import retro

retro.data.Integrations.add_custom_path("integrations")
env = retro.make(game="PokemonYellow-GB")
```

You can then start training with (use `--seed` for deterministic results):

```bash
python train_agent.py --retro-dir integrations\
    --goals data/first_three_gyms.json\
    --config configs/default.json\
    --seed 42\
    --device cuda

If you already imported the ROM into `~/.retro`, the `--retro-dir` argument can
be omitted. You may supply a different goals file using `--goals` and a
different hyperparameter file using `--config`. The resulting network weights
are saved to `ppo_pokemon_yellow.pt` by default.  Use `--output-model` to
specify a different path. During training, goals are
unlocked gradually according to their prerequisites, forming a simple
curriculum.

Use `--device` to select the PyTorch device for training. The default is `'cpu'`.


## Running Tests

The unit tests are written with Python's built-in `unittest` framework. You can run the full suite with:

```bash
python -m unittest discover tests
```

Heavy dependencies such as PyTorch and NumPy are optional. Tests that rely on them are skipped when the packages are not installed, and lightweight stubs are provided for convenience.

